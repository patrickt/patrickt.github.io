<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8" />
        <meta name="author" content="Patrick Thomson" />
        <link rel="stylesheet" type="text/css" href="../stylesheet.css" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>
            adventures in uncertainty: My Emacs Configuration
        </title>
    </head>


    <body>
        <div id="header">
            <a href="../">home</a>
            <a href="../archive.html">archive</a>
            <a href="../about.html">about</a>
            <a href="../contact.html">contact</a>
            <a href="../atom.xml">feed</a>
        </div>
        <div id="content">
            <article>
                <h1>My Emacs Configuration</h1>
                
                  <h2>Or: Emacs is Agar for Brain Worms</h2>
                
                
                  <h3 class="numeral">2020-09-14</h3>
                
                <section>
                    <p>This is my Emacs configuration, assembled over the course of more than ten years. I first started using Emacs in 2009 out of sheer necessity—I first learned to code using <a href="https://github.com/textmate/textmate">TextMate</a>, but that wasn’t an option upon, after arriving at college, being required to SSH into some creaky Sun boxes running geologically-ancient versions of Solaris. As of this writing, it is 2020, some eleven years into my Emacs journey, and I have an incurable case of Emacs-induced brain worms; I’ve spent on the order of hundreds of hours tweaking and refining my configuration. This file is the result of that process.</p>
<p>If there’s anything that convinced me to take on this lifelong Emacs habit, it’s because both macOS and iOS come, out of the box, with support for Emacs keybindings in their text areas. Said keybindings aren’t hugely exhaustive, but they’re useful, especially given that the <code>Ctrl-k</code> and <code>Ctrl-y</code> inputs for copy and paste operate on a <em>different</em> pasteboard than do <code>⌘C</code> and <code>⌘V</code>. Once I discovered that, and the dorkily exhiliating feeling of juggling information through the various system pasteboards, I was more or less entirely beholden to the Emacs way, despite the merits of modal editing<span><label for="sn-0" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-0" class="margin-toggle" /><span class="sidenote">I’ve tried to reconfigure my brain to use modal editing, to little avail, but its model of a domain-specific-language for text editing is a hugely exciting one to me.<br />
<br />
</span></span>. But the forcing factor was, after I left Apple, arriving at a job where I had to test C code on macOS, Linux, FreeBSD, and SmartOS. The difficulty of remembering keyboard shortcuts between TextMate, Sublime Text, and Emacs was leagues beyond insupportable, and as such I took the Emacs plunge.</p>
<p>This file is an <a href="https://en.wikipedia.org/wiki/Org-mode">Org-mode</a> document, like all the posts on my blog. And if you’re reading it on my blog in HTML form, it is because my blog pulls in my Emacs configuration as a submodule, and a conveniently-placed symlink means that it is treated like any other post, and its embedded code is rendered in fancy code blocks. If you’re reading it on <a href="https://github.com/patrickt/emacs">its GitHub repository</a>, you’ll see it rendered inline in the repository, as its filename is <code>readme.org</code>. And at Emacs boot time, Emacs itself runs <code>org-babel</code>, generates elisp code out of the code snippets embedded herein, and loads it; further updates to the blog entry are a <code>git submodule</code> command away. I feel both delight and shame in equal quantities at this state of affairs: having a really cherried-out, custom-built<span><label for="sn-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-1" class="margin-toggle" /><span class="sidenote">My configuration is not built atop one of the all-in-one Emacs distributions like <a href="https://www.spacemacs.org">Spacemacs</a> or <a href="https://github.com/hlissner/doom-emacs">Doom Emacs</a>. I probably would have if either had been around at the beginning of my Emacs journey, but at this point my own personal set of key bindings is burnt into my brain.<br />
<br />
</span></span> Emacs setup is one of those things that’s cool because of how uncool it is, like growing giant vegetables at a county fair, or being really good at Connect Four.</p>
<p>Yet I don’t feel bad about publishing something this self-indulgent. Not only because maybe it’ll demystify what the care and feeding of a very-intense Emacs setup looks like, and also because yak-shaving is an excellent way to occupy myself in quarantine <span><label for="sn-2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-2" class="margin-toggle" /><span class="sidenote">Hello, future generations! If you’re reading this, please believe me when I say that <span class="numeral">2020</span> was a truly enervating time to be a human being.<br />
<br />
</span></span>, but because I’m happier with my setup as an org-mode document, as Emacs configurations generally have a high propensity for entropy: it’s easy to leave a few computer-specific hacks in some dusty corner of a config, and then, upon returning years later, having absolutely no idea what that hack does. Forcing a literate style guilts me into documenting every inch of it. In addition, I have been thanked by strangers for the quality of my config, and my coworker described it as “inspiring”, which seems like sufficient justification to continue, at least with respect to my ego.</p>
<p>This configuration assumes you’re running Emacs 28, the latest version (though I live off of <code>HEAD</code>). Note that I strongly, <em>strongly</em> recommend using an Emacs built with native compilation enabled. The difference in speed is truly profound. Getting <code>libgccjit</code> and friends set up can be a bit of a bear (I use <a href="https://github.com/jimeh/build-emacs-for-macos">this script</a> on macOS), but it’s absolutely essential if you want to live in Emacs to the degree that I do.</p>
<h2 id="canonical-links-to-this-document">Canonical links to this document</h2>
<p>The most up-to-date version of this document is located <a href="https://github.com/patrickt/emacs">on GitHub</a>. A better-rendered version can be found <a href="https://blog.sumtypeofway.com/posts/emacs-config.html">on my blog</a>, but might not be as current as the first version.</p>
<h2 id="todos">TODOs</h2>
<ul>
<li>Make a popper function that gives Magit a bit more breathing room</li>
</ul>
<h1 id="configuration-start">Configuration: start!</h1>
<h2 id="preliminaries">Preliminaries</h2>
<p>We have to be sure to set <code>lexical-binding</code> in the file header to opt into Emacs lexical scope. Emacs Lisp really isn’t the worst language once you pull in the community’s <em>de facto</em> standard libraries, but you need lexical scope.</p>
<div class="sourceCode" id="cb1" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="co">;; -*- coding: utf-8; lexical-binding: t -*-</span></span></code></pre></div>
<p>Many of Emacs’s defaults are ill-suited for my purposes, but the first one that needs fixing is the shockingly low garbage-collection threshold, which defaults to a paltry <span class="numeral">8kb</span>. Setting it to <span class="numeral">100mb</span> seems to strike a nice balance between GC pauses and performance.</p>
<div class="sourceCode" id="cb2" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>(<span class="kw">setq</span> gc-cons-threshold <span class="dv">100000000</span>)</span></code></pre></div>
<p>We use <code>use-package</code> everywhere (it is loaded in the <a href="https://github.com/patrickt/emacs/blob/master/init.el"><code>init.el</code></a> that bootstraps this whole enterprise), save for packages already built into Emacs, and by default we want it to install all mentioned packages. There are some bugs associated with this approach, I am told, but it tends to work for me, and if I get a message about a missing package I just call <code>package-install</code>.</p>
<div class="sourceCode" id="cb3" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>(<span class="kw">setq</span> use-package-always-ensure <span class="kw">t</span>)</span></code></pre></div>
<p>The most useful Emacs command is <code>execute-extended-command</code>. It should be painless to access from the home row. (<code>bind-key*</code> ensures that this setting is propagated through all major modes, which saves us a bunch of <code>unbind-key</code> calls in <code>use-package</code> stanzas.) Why not something even easier, like <code>C-;</code>, you ask? Unfortunately, macOS Terminal.app swallows that keybinding and does nothing with it. I’m sure this is correct behavior by some sort of standard, but I have to work around it, since occasionally I do use Emacs in the terminal.</p>
<div class="sourceCode" id="cb4" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>(bind-key* <span class="st">&quot;C-c ;&quot;</span> #'execute-extended-command)</span></code></pre></div>
<p>Since subsequent packages like <code>libgit</code> may depend on executables like <code>cmake</code>, we need to ensure that Emacs has access to the PATH associated with the current environment.</p>
<div class="sourceCode" id="cb5" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>(<span class="kw">use-package</span> exec-path-from-shell</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>  :init (exec-path-from-shell-initialize))</span></code></pre></div>
<h2 id="fixing-defaults">Fixing defaults</h2>
<p>Fixing Emacs’s defaults is a nontrivial problem. We’ll start with UI concerns.</p>
<div class="sourceCode" id="cb6" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>(<span class="kw">setq</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a> <span class="co">;; No need to see GNU agitprop.</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a> inhibit-startup-screen <span class="kw">t</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a> <span class="co">;; No need to remind me what a scratch buffer is.</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a> initial-scratch-message <span class="kw">nil</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a> <span class="co">;; Double-spaces after periods is morally wrong.</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a> sentence-end-double-space <span class="kw">nil</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a> <span class="co">;; Never ding at me, ever.</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a> ring-bell-function 'ignore</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a> <span class="co">;; Save existing clipboard text into the kill ring before replacing it.</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a> save-interprogram-paste-before-kill <span class="kw">t</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true"></a> <span class="co">;; Prompts should go in the minibuffer, not in a GUI.</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true"></a> use-dialog-box <span class="kw">nil</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true"></a> <span class="co">;; Fix undo in commands affecting the mark.</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true"></a> mark-even-if-inactive <span class="kw">nil</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true"></a> <span class="co">;; Let C-k delete the whole line.</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true"></a> kill-whole-line <span class="kw">t</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true"></a> <span class="co">;; search should be case-sensitive by default</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true"></a> case-fold-search <span class="kw">nil</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true"></a> <span class="co">;; no need to prompt for the read command _every_ time</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true"></a> compilation-read-command <span class="kw">nil</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true"></a> <span class="co">;; scroll to first error</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true"></a> compilation-scroll-output 'first-error</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true"></a> <span class="co">;; accept 'y' or 'n' instead of yes/no</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true"></a> <span class="co">;; the documentation advises against setting this variable</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true"></a> <span class="co">;; the documentation can get bent imo</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true"></a> use-short-answers <span class="kw">t</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true"></a> <span class="co">;; my source directory</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true"></a> default-directory <span class="st">&quot;~/src/&quot;</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true"></a> <span class="co">;; eke out a little more scrolling performance</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true"></a> fast-but-imprecise-scrolling <span class="kw">t</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true"></a> <span class="co">;; prefer newer elisp files</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true"></a> load-prefer-newer <span class="kw">t</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true"></a> <span class="co">;; when I say to quit, I mean quit</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true"></a> confirm-kill-processes <span class="kw">nil</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true"></a> <span class="co">;; if native-comp is having trouble, there's not very much I can do</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true"></a> native-comp-async-report-warnings-errors 'silent</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true"></a> <span class="co">;; unicode ellipses are better</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true"></a> truncate-string-ellipsis <span class="st">&quot;…&quot;</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true"></a> )</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true"></a></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true"></a><span class="co">;; Never mix tabs and spaces. Never use tabs, period.</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true"></a><span class="co">;; We need the setq-default here because this becomes</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true"></a><span class="co">;; a buffer-local variable when set.</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true"></a>(setq-default indent-tabs-mode <span class="kw">nil</span>)</span></code></pre></div>
<p>It’s good that Emacs supports the wide variety of file encodings it does, but UTF-8 should always, <em>always</em> be the default.</p>
<div class="sourceCode" id="cb7" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a>(set-charset-priority 'unicode)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>(prefer-coding-system 'utf<span class="dv">-8</span>-unix)</span></code></pre></div>
<p>We also need to turn on a few modes to have behavior that’s even remotely modern.</p>
<div class="sourceCode" id="cb8" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a>(delete-selection-mode <span class="kw">t</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>(global-display-line-numbers-mode <span class="kw">t</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>(column-number-mode)</span></code></pre></div>
<p>Emacs 27 comes with fast current-line highlight functionality, but it can produce some visual feedback in <code>vterm</code> buffers, so we only activate it in programming or text modes.</p>
<div class="sourceCode" id="cb9" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>(<span class="kw">require</span> 'hl-line)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a>(add-hook 'prog-mode-hook #'hl-line-mode)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a>(add-hook 'text-mode-hook #'hl-line-mode)</span></code></pre></div>
<p>Emacs is super fond of littering filesystems with backups and autosaves, since it was built with the assumption that multiple users could be using the same Emacs instance on the same filesystem. This was valid in 1980. It is no longer the case.</p>
<div class="sourceCode" id="cb10" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a>(<span class="kw">setq</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a> make-backup-files <span class="kw">nil</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a> auto-save-default <span class="kw">nil</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a> create-lockfiles <span class="kw">nil</span>)</span></code></pre></div>
<p>By default, Emacs stores any configuration you make through its UI by writing <code>custom-set-variables</code> invocations to your init file, or to the file specified by <code>custom-file</code>. Though this is convenient, it’s also an excellent way to cause aggravation when the variable you keep trying to modify is being set in some <code>custom-set-variables</code> invocation. We can disable this by mapping it to a temporary file. (I used to map this to <code>/dev/null</code>, but this started causing a bunch of inane save dialogues.)</p>
<div class="sourceCode" id="cb11" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a>(<span class="kw">setq</span> custom-file (make-temp-name <span class="st">&quot;/tmp/&quot;</span>))</span></code></pre></div>
<p>However, because Emacs stores theme-safety information in that file, we have to disable the warnings entirely. This is not particularly secure, but if someone has uploaded malicious code to MELPA inside a theme, I have bigger problems. (Besides, Emacs is not a secure system, and I see no need to try overmuch to make it one.)</p>
<div class="sourceCode" id="cb12" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a>(<span class="kw">setq</span> custom-safe-themes <span class="kw">t</span>)</span></code></pre></div>
<p>Don’t copy this to your config. This just prevents inexplicable failures from elpa.</p>
<div class="sourceCode" id="cb13" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a>(<span class="kw">setq</span> package-check-signature <span class="kw">nil</span>)</span></code></pre></div>
<p>By default, the list of recent files gets cluttered up with the contents of downloaded packages.</p>
<div class="sourceCode" id="cb14" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a>(<span class="kw">use-package</span> recentf</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a>  :config</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a>  (add-to-list 'recentf-exclude <span class="st">&quot;</span><span class="sc">\\</span><span class="st">elpa&quot;</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a>  (add-to-list 'recentf-exclude <span class="st">&quot;private/tmp&quot;</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a>  (recentf-mode))</span></code></pre></div>
<p>Emoji don’t work on Emacs versions &lt; 27 (aside from the Mitsuharu Yamamoto emacs-mac port). However, we can just do this.</p>
<div class="sourceCode" id="cb15" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a>(set-fontset-font <span class="st">&quot;fontset-default&quot;</span> 'unicode <span class="st">&quot;Apple Color Emoji&quot;</span> <span class="kw">nil</span> 'prepend)</span></code></pre></div>
<p>These libraries are helpful to have around when writing little bits of elisp, like the below. You can’t possibly force me to remember the difference between the <code>mapcar</code>, <code>mapc</code>, <code>mapcan</code>, <code>mapconcat</code>, and the <code>cl-</code> versions of some of the aforementioned. I refuse.</p>
<div class="sourceCode" id="cb16" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a>(<span class="kw">use-package</span> s)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a>(<span class="kw">use-package</span> dash)</span></code></pre></div>
<p>There are a great many keybindings that are actively hostile, in that they are bound to useless or obsolete functions that are really easy to trigger accidentally. (The lambda is because <code>unbind-key</code> is a macro.)</p>
<div class="sourceCode" id="cb17" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a>(-map (<span class="kw">lambda</span> (x) (unbind-key x)) '(<span class="st">&quot;C-x C-f&quot;</span> <span class="co">;; find-file-read-only</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a>                                    <span class="st">&quot;C-x C-d&quot;</span> <span class="co">;; list-directory</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a>                                    <span class="st">&quot;C-z&quot;</span> <span class="co">;; suspend-frame</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a>                                    <span class="st">&quot;C-x C-z&quot;</span> <span class="co">;; again</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a>                                    <span class="st">&quot;M-o&quot;</span> <span class="co">;; facemenu-mode</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a>                                    <span class="st">&quot;&lt;mouse-2&gt;&quot;</span> <span class="co">;; pasting with mouse-wheel click</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a>                                    <span class="st">&quot;&lt;C-wheel-down&gt;&quot;</span> <span class="co">;; text scale adjust</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true"></a>                                    <span class="st">&quot;&lt;C-wheel-up&gt;&quot;</span> <span class="co">;; ditto</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true"></a>                                    <span class="st">&quot;s-n&quot;</span> <span class="co">;; make-frame</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true"></a>                                    <span class="st">&quot;C-x C-q&quot;</span> <span class="co">;; read-only-mode</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true"></a>                                    ))</span></code></pre></div>
<p>By default, I want paste operations to indent their results. I could express this as defadvice around the yank command, but I try to avoid such measures if possible.</p>
<div class="sourceCode" id="cb18" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a>(<span class="kw">defun</span><span class="fu"> pt/yank </span>()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a>  <span class="st">&quot;Call yank, then indent the pasted region, as TextMate does.&quot;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a>  (interactive)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a>  (<span class="kw">let</span> ((point-before (point)))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true"></a>    (<span class="kw">if</span> mark-active (call-interactively 'delete-backward-char))</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true"></a>    (yank)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true"></a>    (indent-region point-before (point))))</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true"></a>(bind-key <span class="st">&quot;C-y&quot;</span> #'pt/yank)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true"></a>(bind-key <span class="st">&quot;s-v&quot;</span> #'pt/yank)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true"></a>(bind-key <span class="st">&quot;C-Y&quot;</span> #'yank)</span></code></pre></div>
<p>Searching should be done with isearch, for UI purposes.</p>
<div class="sourceCode" id="cb19" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a>(bind-key <span class="st">&quot;C-s&quot;</span> #'isearch-forward-regexp)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a>(bind-key <span class="st">&quot;C-c s&quot;</span> #'isearch-forward-symbol)</span></code></pre></div>
<p>The out-of-the-box treatment of whitespace is unfortunate, but fixable.</p>
<div class="sourceCode" id="cb20" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a>(add-hook 'before-save-hook #'delete-trailing-whitespace)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true"></a>(<span class="kw">setq</span> require-final-newline <span class="kw">t</span>)</span></code></pre></div>
<p>Emacs instances started outside the terminal do not pick up ssh-agent information unless we use keychain-environment. Note to self: if you keep having to enter your keychain password on macOS, make sure this is in .ssh/config:</p>
<pre><code>Host *
  UseKeychain yes
</code></pre>
<div class="sourceCode" id="cb22" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a>(<span class="kw">use-package</span> keychain-environment</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a>  :config</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true"></a>  (keychain-refresh-environment))</span></code></pre></div>
<p>Emacs is also in love with showing you its NEWS file; it’s bound to like four different keybindings. Overriding the function makes it a no-op. You might say… no news is good news. For that matter, we can elide more GNU agitprop.</p>
<div class="sourceCode" id="cb23" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a>(defalias 'view-emacs-news 'ignore)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true"></a>(defalias 'describe-gnu-project 'ignore)</span></code></pre></div>
<p>Undo has always been problematic for me in Emacs. The beauty of undo-tree is that it means that, once you’ve typed something into a buffer, you’ll always be able to get it back. At least in theory. undo-tree has long-standing data loss bugs that are unlikely to be fixed. But no other package provides a comparable experience.</p>
<div class="sourceCode" id="cb24" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a>(<span class="kw">use-package</span> undo-tree</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a>  :diminish</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true"></a>  :bind ((<span class="st">&quot;C-c _&quot;</span> . undo-tree-visualize))</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true"></a>  :config</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true"></a>  (global-undo-tree-mode +<span class="dv">1</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true"></a>  (unbind-key <span class="st">&quot;M-_&quot;</span> undo-tree-map))</span></code></pre></div>
<p>I define a couple of my own configuration variables with <code>defvar</code>, and no matter how many times I mark the variable as safe, it warns me every time I set it in the <code>.dir-locals</code> file. Disabling these warnings is probably (?) the right thing to do.</p>
<div class="sourceCode" id="cb25" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a>(<span class="kw">setq</span> enable-local-variables :all)</span></code></pre></div>
<p>By default, Emacs wraps long lines, inserting a little icon to indicate this. I find this a bit naff. What we can do to mimic more modern behavior is to allow line truncation by default, but also allow touchpad-style scrolling of the document.</p>
<div class="sourceCode" id="cb26" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a>(<span class="kw">setq</span> mouse-wheel-tilt-scroll <span class="kw">t</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true"></a>      mouse-wheel-flip-direction <span class="kw">t</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true"></a>(setq-default truncate-lines <span class="kw">t</span>)</span></code></pre></div>
<p>By default, Emacs ships with a nice completion system based on buffer contents, but inexplicably cripples its functionality by setting this completion system to ignore case in inserted results. Absolutely remarkable choice of defaults.</p>
<div class="sourceCode" id="cb27" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true"></a>(<span class="kw">use-package</span> dabbrev</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true"></a>  :bind ((<span class="st">&quot;C-/&quot;</span> . #'dabbrev-completion))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true"></a>  :custom</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true"></a>  (dabbrev-case-replace <span class="kw">nil</span>))</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true"></a><span class="co">;; TODO: I want to use the fancy-dabbrev package everywhere,</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true"></a><span class="co">;; but it uses popup.el rather than read-completion, and</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true"></a><span class="co">;; I don't like how quickly it operates on its inline suggestions</span></span></code></pre></div>
<h2 id="visuals">Visuals</h2>
<p>Emacs looks a lot better when it has a modern monospaced font and VSCode-esque icons, as well as smooth scrolling.</p>
<div class="sourceCode" id="cb28" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a>(<span class="kw">ignore-errors</span> (set-frame-font <span class="st">&quot;JuliaMono-12&quot;</span>))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true"></a>(<span class="kw">use-package</span> all-the-icons)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true"></a>(<span class="kw">use-package</span> all-the-icons-dired</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true"></a>  :after all-the-icons</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true"></a>  :hook (dired-mode . all-the-icons-dired-mode))</span></code></pre></div>
<p>Every Emacs window should, by default occupy all the screen space it can.</p>
<div class="sourceCode" id="cb29" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true"></a>(add-to-list 'default-frame-alist '(fullscreen . maximized))</span></code></pre></div>
<p>Window chrome both wastes space and looks unappealing. (This is actually pasted into the first lines of my Emacs configuration so I never have to see the UI chrome, but it is reproduced here for the sake of people who might be taking this configuration for a spin themselves.)</p>
<div class="sourceCode" id="cb30" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true"></a>(<span class="kw">when</span> (window-system)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true"></a>  (tool-bar-mode <span class="dv">-1</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true"></a>  (scroll-bar-mode <span class="dv">-1</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true"></a>  (tooltip-mode <span class="dv">-1</span>))</span></code></pre></div>
<p>I use the <a href="https://github.com/hlissner/emacs-doom-themes">Doom Emacs themes</a>, which are gorgeous. I sometimes also use Modus Vivendi, the excellent new theme that now ships with Emacs.</p>
<div class="sourceCode" id="cb31" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true"></a>(<span class="kw">use-package</span> doom-themes</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true"></a>  :config</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true"></a>  (<span class="kw">let</span> ((chosen-theme 'doom-rouge))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true"></a>    (doom-themes-visual-bell-config)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true"></a>    (doom-themes-org-config)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true"></a>    (<span class="kw">setq</span> doom-challenger-deep-brighter-comments <span class="kw">t</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true"></a>          doom-challenger-deep-brighter-modeline <span class="kw">t</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true"></a>          doom-rouge-brighter-comments <span class="kw">t</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true"></a>          doom-ir-black-brighter-comments <span class="kw">t</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true"></a>          modus-themes-org-blocks 'gray-background</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true"></a>          doom-dark+-blue-modeline <span class="kw">nil</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true"></a>    (load-theme chosen-theme)))</span></code></pre></div>
<p>Most major modes pollute the modeline, so we pull in diminish.el to quiesce them.</p>
<div class="sourceCode" id="cb32" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true"></a>(<span class="kw">use-package</span> diminish</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true"></a>  :config</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true"></a>  (diminish 'visual-line-mode))</span></code></pre></div>
<p>The default modeline is pretty uninspiring, and <code>mood-line</code> is very minimal and pleasing.</p>
<div class="sourceCode" id="cb33" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true"></a>(<span class="kw">use-package</span> mood-line</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true"></a>  :config (mood-line-mode))</span></code></pre></div>
<p>I find it useful to have a slightly more apparent indicator of which buffer is active at the moment.</p>
<div class="sourceCode" id="cb34" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true"></a>(<span class="kw">use-package</span> dimmer</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true"></a>  :custom (dimmer-fraction <span class="fl">0.3</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true"></a>  :config (dimmer-mode))</span></code></pre></div>
<p>Highlighting the closing/opening pair associated with a given parenthesis is essential. Furthermore, parentheses should be delimited by color. I may be colorblind, but it’s good enough, usually.</p>
<div class="sourceCode" id="cb35" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true"></a>(<span class="kw">use-package</span> paren</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true"></a>  :config (show-paren-mode)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true"></a>  :custom (show-paren-style 'expression))</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true"></a>(<span class="kw">use-package</span> rainbow-delimiters</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true"></a>  :hook ((prog-mode . rainbow-delimiters-mode)))</span></code></pre></div>
<p>It’s nice to have the option to center a window, given the considerable size of my screen.</p>
<div class="sourceCode" id="cb36" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true"></a>(<span class="kw">use-package</span> centered-window</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true"></a>  :custom</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true"></a>  (cwm-centered-window-width <span class="dv">180</span>))</span></code></pre></div>
<p>Compilation buffers should wrap their lines.</p>
<div class="sourceCode" id="cb37" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true"></a>(add-hook 'compilation-mode-hook 'visual-line-mode)</span></code></pre></div>
<h3 id="tree-sitter">Tree-sitter</h3>
<p>As part of my day job, I hack on the <a href="https://tree-sitter.github.io"><code>tree-sitter</code></a> parsing toolkit. Pleasingly enough, the parsers generated by <code>tree-sitter</code> can be used to spruce up syntax highlighting within Emacs: for example, highlighting Python with <code>emacs-tree-sitter</code> will correctly highlight code inside format strings, which is really quite useful. Note that for this to work you have to add the tree-sitter ELPA server.</p>
<div class="sourceCode" id="cb38" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true"></a>(<span class="kw">use-package</span> tree-sitter</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true"></a>  :hook ((ruby-mode . tree-sitter-hl-mode)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true"></a>         (js-mode . tree-sitter-hl-mode)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true"></a>         (rust-mode . tree-sitter-hl-mode)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true"></a>         (sh-mode . tree-sitter-hl-mode)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true"></a>         (c-mode . tree-sitter-hl-mode)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true"></a>         (typescript-mode . tree-sitter-hl-mode)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true"></a>         (go-mode . tree-sitter-hl-mode)))</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true"></a>(<span class="kw">use-package</span> tree-sitter-langs)</span></code></pre></div>
<h3 id="tabs">Tabs</h3>
<p>The long-awaited Emacs 27 support for native tabs is shaky, both visually and in terms of functionality. As such, <code>centaur-tabs</code> is the best way to simulate a conventional tabs setup, in which tab sets are grouped by the toplevel project working directory.</p>
<div class="sourceCode" id="cb39" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true"></a>(<span class="kw">use-package</span> centaur-tabs</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true"></a>  :config</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true"></a>  (centaur-tabs-mode <span class="kw">t</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true"></a>  :custom</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true"></a>  (centaur-tabs-set-icons <span class="kw">nil</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true"></a>  (centaur-tabs-show-new-tab-button <span class="kw">nil</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true"></a>  (centaur-tabs-set-close-button <span class="kw">nil</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true"></a>  (centaur-tabs-enable-ido-completion <span class="kw">nil</span>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true"></a>  :bind</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true"></a>  ((<span class="st">&quot;s-{&quot;</span> . #'centaur-tabs-backward)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true"></a>   (<span class="st">&quot;s-}&quot;</span> . #'centaur-tabs-forward)))</span></code></pre></div>
<h2 id="text-manipulation">Text manipulation</h2>
<p>Being able to</p>
<p>Any modern editor should include multiple-cursor support. Sure, keyboard macros would suffice, sometimes. Let me live. I haven’t yet taken advantage of many of the <code>multiple-cursors</code> commands. Someday.</p>
<div class="sourceCode" id="cb40" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true"></a>(<span class="kw">use-package</span> multiple-cursors</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true"></a>  :bind ((<span class="st">&quot;C-c C-e m&quot;</span> . #'mc/edit-lines)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true"></a>         (<span class="st">&quot;C-c C-e d&quot;</span> . #'mc/mark-all-dwim)))</span></code></pre></div>
<p>The <code>fill-paragraph</code> (<code>M-q</code>) command can be useful for formatting long text lines in a pleasing matter. I don’t do it in every document, but when I do, I want more columns than the default <span class="numeral">70</span>.</p>
<div class="sourceCode" id="cb41" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true"></a>(setq-default fill-column <span class="dv">135</span>)</span></code></pre></div>
<p>Textmate-style tap-to-expand-into-the-current-delimiter is very useful and curiously absent.</p>
<div class="sourceCode" id="cb42" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true"></a>(<span class="kw">use-package</span> expand-region</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true"></a>  :bind ((<span class="st">&quot;C-c n&quot;</span> . er/expand-region)))</span></code></pre></div>
<p>Emacs’s keybinding for <code>comment-dwim</code> is <code>M-;</code>, which is not convenient to type or particularly mnemonic outside of an elisp context (where commenting is indeed <code>;</code>). Better to bind it somewhere sensible.</p>
<div class="sourceCode" id="cb43" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true"></a>(bind-key* <span class="st">&quot;C-c /&quot;</span> #'comment-dwim)</span></code></pre></div>
<p><code>avy</code> gives us fluent jump-to-line commands mapped to the home row.</p>
<div class="sourceCode" id="cb44" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true"></a>(<span class="kw">use-package</span> avy</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true"></a>  :bind (:map prog-mode-map (<span class="st">&quot;C-'&quot;</span> . avy-goto-line))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true"></a>  :bind (:map org-mode-map (<span class="st">&quot;C-'&quot;</span> . avy-goto-line))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true"></a>  :bind ((<span class="st">&quot;C-c l&quot;</span> . avy-goto-line)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true"></a>         (<span class="st">&quot;C-c j&quot;</span> . avy-goto-char)))</span></code></pre></div>
<p><code>iedit</code> gives us the very popular idiom of automatically deploying multiple cursors to edit all occurrences of a particular word.</p>
<div class="sourceCode" id="cb45" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true"></a>(<span class="kw">use-package</span> iedit :defer <span class="kw">t</span>)</span></code></pre></div>
<p>Parenthesis matching is one of the flaws in my Emacs setup as of this writing. I know that there are a lot of options out there—<code>paredit</code>, <code>smartparens</code>, etc.—but I haven’t sat down and really capital-L Learned a better solution than the TextMate-style bracket completion (which Emacs calls, somewhat fancifully, ‘electric’).</p>
<div class="sourceCode" id="cb46" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true"></a>(electric-pair-mode)</span></code></pre></div>
<p>I got used to a number of convenient TextMate-style commands.</p>
<div class="sourceCode" id="cb47" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true"></a>(<span class="kw">defun</span><span class="fu"> pt/eol-then-newline </span>()</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true"></a>  <span class="st">&quot;Go to end of line, then newline-and-indent.&quot;</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true"></a>  (interactive)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true"></a>  (move-end-of-line <span class="kw">nil</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true"></a>  (newline-and-indent))</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true"></a>(bind-key <span class="st">&quot;s-&lt;return&gt;&quot;</span> #'pt/eol-then-newline)</span></code></pre></div>
<p>It’s occasionally useful to be able to search a Unicode character by name. And it’s a measure of Emacs’s performance, when using native-comp and Vertico, that you can search the entire Unicode character space without any keystroke latency.</p>
<div class="sourceCode" id="cb48" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true"></a>(bind-key <span class="st">&quot;C-c U&quot;</span> #'insert-char)</span></code></pre></div>
<h2 id="quality-of-life-improvements">Quality-of-life improvements</h2>
<p>We start by binding a few builtin commands to more-convenient keystrokes.</p>
<div class="sourceCode" id="cb49" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true"></a>(<span class="kw">defun</span><span class="fu"> pt/split-window-thirds </span>()</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true"></a>  <span class="st">&quot;Split a window into thirds.&quot;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true"></a>  (interactive)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true"></a>  (split-window-right)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true"></a>  (split-window-right)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true"></a>  (balance-windows))</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true"></a>(bind-key <span class="st">&quot;C-c 3&quot;</span> #'pt/split-window-thirds)</span></code></pre></div>
<p>Given how often I tweak my config, I bind <code>C-c e</code> to take me to my config file.</p>
<div class="sourceCode" id="cb50" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true"></a>(<span class="kw">defun</span><span class="fu"> open-init-file </span>()</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true"></a>  <span class="st">&quot;Open this very file.&quot;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true"></a>  (interactive)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true"></a>  (find-file <span class="st">&quot;~/.config/emacs/readme.org&quot;</span>))</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true"></a>(bind-key <span class="st">&quot;C-c e&quot;</span> #'open-init-file)</span></code></pre></div>
<p>Standard macOS conventions would have <code>s-w</code> close the current buffer, not the whole window.</p>
<div class="sourceCode" id="cb51" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true"></a>(bind-key <span class="st">&quot;s-w&quot;</span> #'kill-this-buffer)</span></code></pre></div>
<p>Emacs makes it weirdly hard to just, like, edit a file as root, probably due to supporting operating systems not built on <code>sudo</code>. Enter the <code>sudo-edit</code> package.</p>
<div class="sourceCode" id="cb52" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true"></a>(<span class="kw">use-package</span> sudo-edit)</span></code></pre></div>
<p>By default, Emacs uses a new buffer for every directory you visit in dired. This is not only terrible from a UI perspective—Emacs warns you if you try to use the sensible behavior (the <code>a</code> key, <code>dired-find-alternate-file</code>). Willfully obtuse. The <code>dired+.el</code> library fixes this, but because it’s not on MELPA, I refuse to use it out of principle (this man’s refusal to compromise is nothing short of crankery, and it would be intellectually remiss of me to abet his crankery). But, as always, we can make Emacs do the right thing. Manually. Furthermore, dired complains every time it’s opened on Darwin, so we should fix that.</p>
<div class="sourceCode" id="cb53" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true"></a>(<span class="kw">defun</span><span class="fu"> dired-up-directory-same-buffer </span>()</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true"></a>  <span class="st">&quot;Go up in the same buffer.&quot;</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true"></a>  (find-alternate-file <span class="st">&quot;..&quot;</span>))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true"></a>(<span class="kw">defun</span><span class="fu"> my-dired-mode-hook </span>()</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true"></a>  (put 'dired-find-alternate-file 'disabled <span class="kw">nil</span>) <span class="co">; Disables the warning.</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true"></a>  (define-key dired-mode-map (kbd <span class="st">&quot;RET&quot;</span>) 'dired-find-alternate-file)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true"></a>  (define-key dired-mode-map (kbd <span class="st">&quot;^&quot;</span>) 'dired-up-directory-same-buffer))</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true"></a>(add-hook 'dired-mode-hook #'my-dired-mode-hook)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true"></a>(<span class="kw">setq</span> dired-use-ls-dired <span class="kw">nil</span>)</span></code></pre></div>
<p>Emacs has problems with very long lines. <code>so-long</code> detects them and takes appropriate action. Good for minified code and whatnot.</p>
<div class="sourceCode" id="cb54" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true"></a>(global-so-long-mode)</span></code></pre></div>
<p>I’ve never needed a font panel in Emacs, not even once.</p>
<div class="sourceCode" id="cb55" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true"></a>(unbind-key <span class="st">&quot;s-t&quot;</span>)</span></code></pre></div>
<p>It’s genuinely shocking that there’s no “duplicate whatever’s marked” command built-in.</p>
<div class="sourceCode" id="cb56" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true"></a>(<span class="kw">use-package</span> duplicate-thing</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true"></a>  :init</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true"></a>  (<span class="kw">defun</span><span class="fu"> pt/duplicate-thing </span>()</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true"></a>    <span class="st">&quot;Duplicate thing at point without changing the mark.&quot;</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true"></a>    (interactive)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true"></a>    (save-mark-and-excursion (duplicate-thing <span class="dv">1</span>))</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true"></a>    (call-interactively #'next-line))</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true"></a>  :bind ((<span class="st">&quot;C-c u&quot;</span> . pt/duplicate-thing)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true"></a>         (<span class="st">&quot;C-c C-u&quot;</span> . pt/duplicate-thing)))</span></code></pre></div>
<p>We need to support reading large blobs of data for LSP’s sake.</p>
<div class="sourceCode" id="cb57" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true"></a>(<span class="kw">setq</span> read-process-output-max (<span class="op">*</span> <span class="dv">1024</span> <span class="dv">1024</span>)) <span class="co">; 1mb</span></span></code></pre></div>
<p>When I hit, accidentally or purposefully, a key chord that forms the prefix of some other chords, I want to see a list of possible completions and their info.</p>
<div class="sourceCode" id="cb58" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true"></a>(<span class="kw">use-package</span> which-key</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true"></a>  :diminish</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true"></a>  :custom</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true"></a>  (which-key-enable-extended-define-key <span class="kw">t</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true"></a>  :config</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true"></a>  (which-key-mode)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true"></a>  (which-key-setup-minibuffer))</span></code></pre></div>
<div class="sourceCode" id="cb59" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true"></a>(<span class="kw">defun</span><span class="fu"> display-startup-echo-area-message </span>()</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true"></a>  <span class="st">&quot;Override the normally tedious startup message.&quot;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true"></a>  (message <span class="st">&quot;Welcome back.&quot;</span>))</span></code></pre></div>
<p>Emacs has an <code>executable-prefix-env</code> command that adds a magic shebang line to scripts in interpreted languages. With a little cajoling, it can use <code>env(1)</code> instead of hardcoding the interpreter path, which is slightly more robust in certain circumstances.</p>
<div class="sourceCode" id="cb60" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true"></a>(<span class="kw">setq</span> executable-prefix-env <span class="kw">t</span>)</span></code></pre></div>
<p>The new <code>context-menu-mode</code> in Emacs 28 makes right-click a lot more useful. But for terminal emacs, it’s handy to have the menubar at hand.</p>
<div class="sourceCode" id="cb61" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true"></a>(context-menu-mode)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true"></a>(bind-key <span class="st">&quot;C-c C-m&quot;</span> #'tmm-menubar)</span></code></pre></div>
<h2 id="buffer-management">Buffer management</h2>
<p>I almost always want to default to a two-buffer setup.</p>
<div class="sourceCode" id="cb62" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true"></a>(<span class="kw">defun</span><span class="fu"> revert-to-two-windows </span>()</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true"></a>  <span class="st">&quot;Delete all other windows and split it into two.&quot;</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true"></a>  (interactive)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true"></a>  (delete-other-windows)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true"></a>  (split-window-right))</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true"></a>(bind-key <span class="st">&quot;C-x 1&quot;</span> #'revert-to-two-windows)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true"></a>(bind-key <span class="st">&quot;C-x !&quot;</span> #'delete-other-windows) <span class="co">;; Access to the old keybinding.</span></span></code></pre></div>
<p><code>keyboard-quit</code> doesn’t exit the minibuffer, so I give <code>abort-recursive-edit</code>, which does, a more convenient keybinding.</p>
<div class="sourceCode" id="cb63" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true"></a>(bind-key <span class="st">&quot;s-g&quot;</span> #'abort-recursive-edit)</span></code></pre></div>
<p>Completion systems make <code>kill-buffer</code> give you a list of possible results, which isn’t generally what I want.</p>
<div class="sourceCode" id="cb64" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true"></a>(<span class="kw">defun</span><span class="fu"> kill-this-buffer </span>()</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true"></a>  <span class="st">&quot;Kill the current buffer.&quot;</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true"></a>  (interactive)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true"></a>  (kill-buffer <span class="kw">nil</span>)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true"></a>  )</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true"></a>(bind-key <span class="st">&quot;C-x k&quot;</span> #'kill-this-buffer)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true"></a>(bind-key <span class="st">&quot;C-x K&quot;</span> #'kill-buffer)</span></code></pre></div>
<p>Also, it’s nice to be able to kill all buffers.</p>
<div class="sourceCode" id="cb65" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true"></a>(<span class="kw">defun</span><span class="fu"> kill-all-buffers </span>()</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true"></a>  <span class="st">&quot;Close all buffers.&quot;</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true"></a>  (interactive)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true"></a>  (<span class="kw">let</span> ((lsp-restart 'ignore))</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true"></a>    <span class="co">;; (maybe-unset-buffer-modified)</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true"></a>    (delete-other-windows)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true"></a>    (save-some-buffers)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true"></a>    (<span class="kw">let</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true"></a>        ((kill-buffer-query-functions '()))</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true"></a>      (<span class="kw">mapc</span> 'kill-buffer (buffer-list)))))</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true"></a></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true"></a>(bind-key <span class="st">&quot;C-c K&quot;</span> #'kill-all-buffers)</span></code></pre></div>
<p>VS Code has a great feature where you can just copy a filename to the clipboard. We can write it in a more sophisticated manner in Emacs, which is nice.</p>
<div class="sourceCode" id="cb66" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true"></a>(<span class="kw">defun</span><span class="fu"> copy-file-name-to-clipboard </span>(do-not-strip-prefix)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true"></a>  <span class="st">&quot;Copy the current buffer file name to the clipboard. The path will be relative to the project's root directory, if set. Invoking with a prefix argument copies the full path.&quot;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true"></a>  (interactive <span class="st">&quot;P&quot;</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true"></a>  (letrec</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true"></a>      ((fullname (<span class="kw">if</span> (<span class="kw">equal</span> major-mode 'dired-mode) default-directory (buffer-file-name)))</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true"></a>       (root (project-root (project-current)))</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true"></a>       (relname (file-relative-name fullname root))</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true"></a>       (should-strip (<span class="kw">and</span> root (<span class="kw">not</span> do-not-strip-prefix)))</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true"></a>       (filename (<span class="kw">if</span> should-strip relname fullname)))</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true"></a>    (kill-new filename)</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true"></a>    (message <span class="st">&quot;Copied buffer file name '%s' to the clipboard.&quot;</span> filename)))</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true"></a></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true"></a>(bind-key <span class="st">&quot;C-c p&quot;</span> #'copy-file-name-to-clipboard)</span></code></pre></div>
<p>Normally I bind <code>other-window</code> to <code>C-c ,</code>, but on my ultra-wide-screen monitor, which supports up to 8 buffers comfortably, holding that key to move around buffers is kind of a drag. Some useful commands to remember here are <code>aw-ignore-current</code> and <code>aw-ignore-on</code>.</p>
<div class="sourceCode" id="cb67" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true"></a>(<span class="kw">use-package</span> ace-window</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true"></a>  :config</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true"></a>  <span class="co">;; Show the window designators in the modeline.</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true"></a>  (ace-window-display-mode)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true"></a>  :bind* ((<span class="st">&quot;C-&lt;&quot;</span> . other-window) (<span class="st">&quot;C-,&quot;</span> . ace-window))</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true"></a>  :custom</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true"></a>  (aw-keys '(?a ?s ?d ?f ?g ?h ?j ?k ?l) <span class="st">&quot;Designate windows by home row keys, not numbers.&quot;</span>)</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true"></a>  (aw-background <span class="kw">nil</span>))</span></code></pre></div>
<p>Emacs allows you to, while the minibuffer is active, invoke another command that uses the minibuffer, in essence making the minibuffer from a single editing action into a stack of editing actions. In this particular instance, I think it’s appropriate to have it off by default, simply for the sake of beginners who don’t have a mental model of the minibuffer yet. But at this point, it’s too handy for me to discard. Handily enough, Emacs can report your current depth of recursive minibuffer invocations in the modeline.</p>
<div class="sourceCode" id="cb68" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true"></a>(<span class="kw">setq</span> enable-recursive-minibuffers <span class="kw">t</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true"></a>(minibuffer-depth-indicate-mode)</span></code></pre></div>
<p>It’s useful to have a scratch buffer around, and more useful to have a key chord to switch to it.</p>
<div class="sourceCode" id="cb69" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true"></a>(<span class="kw">defun</span><span class="fu"> switch-to-scratch-buffer </span>()</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true"></a>  <span class="st">&quot;Switch to the current session's scratch buffer.&quot;</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true"></a>  (interactive)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true"></a>  (switch-to-buffer <span class="st">&quot;*scratch*&quot;</span>))</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true"></a>(bind-key <span class="st">&quot;C-c a s&quot;</span> #'switch-to-scratch-buffer)</span></code></pre></div>
<p>One of the main problems with Emacs is how many ephemeral buffers it creates. I’m giving <code>popper-mode</code> a try to see if it can stem the flood thereof. Note that vterm is not included here because vterm-toggle doesn’t play particularly nicely with popper.</p>
<div class="sourceCode" id="cb70" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true"></a>(<span class="kw">use-package</span> popper</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true"></a>  :bind* (<span class="st">&quot;C-c :&quot;</span> . popper-toggle-latest)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true"></a>  :bind ((<span class="st">&quot;C-`&quot;</span>   . popper-toggle-latest)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true"></a>         (<span class="st">&quot;C-</span><span class="sc">\\</span><span class="st">&quot;</span>  . popper-cycle)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true"></a>         (<span class="st">&quot;C-M-`&quot;</span> . popper-toggle-type))</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true"></a>  :config</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true"></a>  (popper-mode +<span class="dv">1</span>)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true"></a>  (popper-echo-mode +<span class="dv">1</span>)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true"></a>  :custom</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true"></a>  (popper-reference-buffers '(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">*Messages</span><span class="sc">\\</span><span class="st">*&quot;</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true"></a>                              <span class="st">&quot;Output</span><span class="sc">\\</span><span class="st">*$&quot;</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true"></a>                              <span class="st">&quot;</span><span class="sc">\\</span><span class="st">*Async Shell Command</span><span class="sc">\\</span><span class="st">*&quot;</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true"></a>                              help-mode</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true"></a>                              prodigy-mode</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true"></a>                              <span class="st">&quot;magit:.\*&quot;</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true"></a>                              <span class="st">&quot;</span><span class="sc">\\</span><span class="st">*deadgrep.\*&quot;</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true"></a>                              <span class="st">&quot;</span><span class="sc">\\</span><span class="st">*eldoc.\*&quot;</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true"></a>                              <span class="st">&quot;</span><span class="sc">\\</span><span class="st">*xref</span><span class="sc">\\</span><span class="st">*&quot;</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true"></a>                              <span class="st">&quot;</span><span class="sc">\\</span><span class="st">*direnv</span><span class="sc">\\</span><span class="st">*&quot;</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true"></a>                              <span class="st">&quot;</span><span class="sc">\\</span><span class="st">*Warnings</span><span class="sc">\\</span><span class="st">*&quot;</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true"></a>                              <span class="st">&quot;</span><span class="sc">\\</span><span class="st">*Bookmark List</span><span class="sc">\\</span><span class="st">*&quot;</span></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true"></a>                              haskell-compilation-mode</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true"></a>                              compilation-mode</span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true"></a>                              bqn-inferior-mode))</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true"></a>  )</span></code></pre></div>
<h2 id="org-mode">Org-mode</h2>
<p>Even though my whole-ass blogging workflow is built around org-mode, I still can’t say that I know it very well. I don’t take advantage of <code>org-agenda</code>, <code>org-timer</code>, <code>org-calendar</code>, <code>org-capture</code>, anything interesting to do with tags, et cetera. Someday I will learn these things, but not yet.</p>
<div class="sourceCode" id="cb71" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true"></a>(<span class="kw">use-package</span> org</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true"></a>  :hook (org-mode . visual-line-mode)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true"></a>  :bind ((<span class="st">&quot;C-c o c&quot;</span> . counsel-org-capture)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true"></a>         (<span class="st">&quot;C-c o a&quot;</span> . org-agenda)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true"></a>         :map org-mode-map</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true"></a>         (<span class="st">&quot;M-&lt;left&gt;&quot;</span> . <span class="kw">nil</span>)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true"></a>         (<span class="st">&quot;M-&lt;right&gt;&quot;</span> . <span class="kw">nil</span>)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true"></a>         (<span class="st">&quot;C-c c&quot;</span> . #'org-mode-insert-code)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true"></a>         (<span class="st">&quot;C-c a f&quot;</span> . #'org-shifttab)</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true"></a>         (<span class="st">&quot;C-c a S&quot;</span> . #'zero-width))</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true"></a>  :custom</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true"></a>  (org-adapt-indentation <span class="kw">nil</span>)</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true"></a>  (org-directory <span class="st">&quot;~/txt&quot;</span>)</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true"></a>  (org-default-notes-file (concat org-directory <span class="st">&quot;/notes.org&quot;</span>))</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true"></a>  (org-return-follows-link <span class="kw">t</span>)</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true"></a>  (org-src-ask-before-returning-to-edit-buffer <span class="kw">nil</span> <span class="st">&quot;org-src is kinda needy out of the box&quot;</span>)</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true"></a>  (org-src-window-setup 'current-window)</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true"></a>  (org-agenda-files (<span class="kw">list</span> (concat org-directory <span class="st">&quot;/agenda.org&quot;</span>)))</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true"></a></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true"></a>  :config</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true"></a>  (<span class="kw">defun</span><span class="fu"> pt/org-mode-hook </span>()</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true"></a>    (<span class="kw">when</span> (s-suffix? <span class="st">&quot;todo.org&quot;</span> (buffer-file-name (current-buffer)))</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true"></a>      (real-auto-save-mode)))</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true"></a>  (<span class="kw">defun</span><span class="fu"> make-inserter </span>(c) '(<span class="kw">lambda</span> () (interactive) (insert-char c)))</span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true"></a>  (<span class="kw">defun</span><span class="fu"> zero-width </span>() (interactive) (insert <span class="st">&quot;​&quot;</span>))</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true"></a></span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true"></a>  (<span class="kw">defun</span><span class="fu"> org-mode-insert-code </span>()</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true"></a>    <span class="st">&quot;Like markdown-insert-code, but for org instead.&quot;</span></span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true"></a>    (interactive)</span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true"></a>    (org-emphasize ?~)))</span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true"></a></span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true"></a>(<span class="kw">use-package</span> org-bullets</span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true"></a>  :hook (org-mode . org-bullets-mode))</span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true"></a></span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true"></a>(<span class="kw">use-package</span> org-ref</span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true"></a>  :disabled <span class="co">;; very slow to load</span></span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true"></a>  :config (defalias 'dnd-unescape-uri 'dnd--unescape-uri))</span>
<span id="cb71-38"><a href="#cb71-38" aria-hidden="true"></a></span>
<span id="cb71-39"><a href="#cb71-39" aria-hidden="true"></a>(<span class="kw">use-package</span> org-roam</span>
<span id="cb71-40"><a href="#cb71-40" aria-hidden="true"></a>  :bind</span>
<span id="cb71-41"><a href="#cb71-41" aria-hidden="true"></a>  ((<span class="st">&quot;C-c o r&quot;</span> . org-roam-capture)</span>
<span id="cb71-42"><a href="#cb71-42" aria-hidden="true"></a>   (<span class="st">&quot;C-c o f&quot;</span> . org-roam-node-find))</span>
<span id="cb71-43"><a href="#cb71-43" aria-hidden="true"></a>  :custom</span>
<span id="cb71-44"><a href="#cb71-44" aria-hidden="true"></a>  (org-roam-directory (expand-file-name <span class="st">&quot;~/Dropbox/txt/roam&quot;</span>))</span>
<span id="cb71-45"><a href="#cb71-45" aria-hidden="true"></a>  (org-roam-v2-ack <span class="kw">t</span>)</span>
<span id="cb71-46"><a href="#cb71-46" aria-hidden="true"></a>  :config</span>
<span id="cb71-47"><a href="#cb71-47" aria-hidden="true"></a>  (org-roam-db-autosync-mode))</span></code></pre></div>
<h1 id="keymacs-support">Keymacs support</h1>
<p>I recently acquired a <a href="https://keymacs.com">Keymacs A620N</a>, a reproduction of the <a href="https://deskthority.net/wiki/Symbolics_365407">Symbolics 365407</a>, from 1983. Though it’s expensive, it’s unquestionably the nicest keyboard I’ve ever used, given its vintage ALPS switches; of the keyboards I’ve used, only the keyboard.io comes close. It’s big enough that it has a preposterous amount of function keys.</p>
<div class="sourceCode" id="cb72" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true"></a>(bind-key <span class="st">&quot;&lt;f12&gt;&quot;</span> #'other-window)</span></code></pre></div>
<h1 id="ide-features">IDE features</h1>
<h2 id="magit">Magit</h2>
<p>Magit is one of the top three reasons anyone should use Emacs. What a brilliant piece of software it is. I never thought I’d be faster with a git GUI than with the command line, since I’ve been using git for thirteen years at this point, but wonders really never cease. Magit is as good as everyone says, and more.</p>
<div class="sourceCode" id="cb73" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true"></a>(<span class="kw">use-package</span> magit</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true"></a>  :diminish magit-auto-revert-mode</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true"></a>  :diminish auto-revert-mode</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true"></a>  :bind ((<span class="st">&quot;C-c g&quot;</span> . #'magit-status))</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true"></a>  :custom</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true"></a>  (magit-repository-directories '((<span class="st">&quot;~/src&quot;</span> . <span class="dv">1</span>)))</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true"></a>  :config</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true"></a>  (add-to-list 'magit-no-confirm 'stage-all-changes))</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true"></a></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true"></a>(<span class="kw">use-package</span> libgit :after magit)</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true"></a></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true"></a>(<span class="kw">use-package</span> magit-libgit</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true"></a>  :after (magit libgit))</span></code></pre></div>
<p>Magit also allows integration with GitHub and other such forges (though I hate that term).</p>
<div class="sourceCode" id="cb74" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true"></a>(<span class="kw">use-package</span> forge</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true"></a>  :after magit)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true"></a><span class="co">;; hack to eliminate weirdness</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true"></a>(<span class="kw">unless</span> (<span class="kw">boundp</span> 'bug-reference-auto-setup-functions)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true"></a>  (<span class="kw">defvar</span><span class="fu"> bug-reference-auto-setup-functions </span>'()))</span></code></pre></div>
<p>The code-review package allows for integration with pull request comments and such.</p>
<div class="sourceCode" id="cb75" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true"></a>(<span class="kw">use-package</span> code-review</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true"></a>  :after magit</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true"></a>  :bind (:map forge-topic-mode-map (<span class="st">&quot;C-c r&quot;</span> . #'code-review-forge-pr-at-point))</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true"></a>  :bind (:map code-review-mode-map ((<span class="st">&quot;C-c n&quot;</span> . #'code-review-comment-jump-next)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true"></a>                                    (<span class="st">&quot;C-c p&quot;</span> . #'code-review-comment-jump-previous))))</span></code></pre></div>
<h2 id="project-navigation">Project navigation</h2>
<p>I used to use Projectile, but <code>marginalia-mode</code> doesn’t appear to work out of the box with it. Besides, there’s no reason to pull in a separate package when the builtin <code>project.el</code> works fine. We pin it to GNU ELPA to pull the latest version.</p>
<div class="sourceCode" id="cb76" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true"></a>(<span class="kw">use-package</span> project</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true"></a>  :pin gnu</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true"></a>  :bind ((<span class="st">&quot;C-c k&quot;</span> . #'project-kill-buffers)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true"></a>         (<span class="st">&quot;C-c m&quot;</span> . #'project-compile)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true"></a>         (<span class="st">&quot;C-x f&quot;</span> . #'find-file)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true"></a>         (<span class="st">&quot;C-c f&quot;</span> . #'project-find-file)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true"></a>         (<span class="st">&quot;C-c F&quot;</span> . #'project-switch-project))</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true"></a>  :custom</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true"></a>  <span class="co">;; This is one of my favorite things: you can customize</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true"></a>  <span class="co">;; the options shown upon switching projects.</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true"></a>  (project-switch-commands</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true"></a>   '((project-find-file <span class="st">&quot;Find file&quot;</span>)</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true"></a>     (magit-project-status <span class="st">&quot;Magit&quot;</span> ?g)</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true"></a>     (deadgrep <span class="st">&quot;Grep&quot;</span> ?h)))</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true"></a>  (compilation-always-kill <span class="kw">t</span>)</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true"></a>  (project-vc-merge-submodules <span class="kw">nil</span>)</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true"></a>  )</span></code></pre></div>
<h2 id="completion-and-input">Completion and input</h2>
<p>My journey through the various Emacs completion facilities has been long and twisty. I started with Helm, then spent several years using Ivy, and am now using Vertico, with the consult and marginalia packages to yield an interface that is nicer and faster than Ivy.</p>
<div class="sourceCode" id="cb77" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true"></a>(<span class="kw">use-package</span> vertico</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true"></a>  :config</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true"></a>  (vertico-mode)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true"></a>  (vertico-mouse-mode)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true"></a>  :custom</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true"></a>  (vertico-count <span class="dv">22</span>)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true"></a>  :bind (:map vertico-map</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true"></a>              (<span class="st">&quot;C-'&quot;</span>       . #'vertico-quick-exit)</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true"></a>              <span class="co">;; Have to rebind this because C-m is translated to RET.</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true"></a>              (<span class="st">&quot;&lt;return&gt;&quot;</span>  . #'exit-minibuffer)</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true"></a>              (<span class="st">&quot;C-m&quot;</span>       . #'vertico-insert)</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true"></a>              (<span class="st">&quot;C-c SPC&quot;</span>   . #'vertico-quick-exit)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true"></a>              (<span class="st">&quot;DEL&quot;</span>       . #'vertico-directory-delete-char)))</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true"></a></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true"></a>(<span class="kw">use-package</span> consult</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true"></a>  :config</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true"></a>  (<span class="kw">defun</span><span class="fu"> pt/yank-pop </span>()</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true"></a>    <span class="st">&quot;As pt/yank, but calling consult-yank-pop.&quot;</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true"></a>    (interactive)</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true"></a>    (<span class="kw">let</span> ((point-before (point)))</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true"></a>      (consult-yank-pop)</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true"></a>      (indent-region point-before (point))))</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true"></a></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true"></a>  :bind ((<span class="st">&quot;C-c i&quot;</span>   . #'consult-imenu)</span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true"></a>         (<span class="st">&quot;C-c b&quot;</span>   . #'consult-buffer)</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true"></a>         (<span class="st">&quot;C-x b&quot;</span>   . #'consult-buffer)</span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true"></a>         (<span class="st">&quot;C-c r&quot;</span>   . #'consult-recent-file)</span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true"></a>         (<span class="st">&quot;C-c y&quot;</span>   . #'pt/yank-pop)</span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true"></a>         (<span class="st">&quot;C-c R&quot;</span>   . #'consult-bookmark)</span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true"></a>         (<span class="st">&quot;C-c `&quot;</span>   . #'consult-flymake)</span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true"></a>         (<span class="st">&quot;C-c h&quot;</span>   . #'consult-ripgrep)</span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true"></a>         (<span class="st">&quot;C-x C-f&quot;</span> . #'find-file)</span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true"></a>         (<span class="st">&quot;C-h a&quot;</span>   . #'consult-apropos)</span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true"></a>         )</span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true"></a>  :custom</span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true"></a>  (completion-in-region-function #'consult-completion-in-region)</span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true"></a>  (xref-show-xrefs-function #'consult-xref)</span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true"></a>  (xref-show-definitions-function #'consult-xref)</span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true"></a>  (consult-project-root-function #'deadgrep--project-root) <span class="co">;; ensure ripgrep works</span></span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true"></a>  )</span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true"></a></span>
<span id="cb77-42"><a href="#cb77-42" aria-hidden="true"></a>(<span class="kw">use-package</span> marginalia</span>
<span id="cb77-43"><a href="#cb77-43" aria-hidden="true"></a>  :config (marginalia-mode))</span>
<span id="cb77-44"><a href="#cb77-44" aria-hidden="true"></a></span>
<span id="cb77-45"><a href="#cb77-45" aria-hidden="true"></a>(<span class="kw">use-package</span> orderless</span>
<span id="cb77-46"><a href="#cb77-46" aria-hidden="true"></a>  :custom (completion-styles '(orderless)))</span>
<span id="cb77-47"><a href="#cb77-47" aria-hidden="true"></a></span>
<span id="cb77-48"><a href="#cb77-48" aria-hidden="true"></a>(<span class="kw">use-package</span> ctrlf</span>
<span id="cb77-49"><a href="#cb77-49" aria-hidden="true"></a>  :config (ctrlf-mode))</span>
<span id="cb77-50"><a href="#cb77-50" aria-hidden="true"></a></span>
<span id="cb77-51"><a href="#cb77-51" aria-hidden="true"></a>(<span class="kw">use-package</span> prescient</span>
<span id="cb77-52"><a href="#cb77-52" aria-hidden="true"></a>  :config (prescient-persist-mode))</span></code></pre></div>
<p>Dumb-jump is pretty good at figuring out where declarations of things might be. I’m using it with C because I’m too lazy to set up true C LSP integration.</p>
<div class="sourceCode" id="cb78" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true"></a>(<span class="kw">use-package</span> dumb-jump</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true"></a>  :bind ((<span class="st">&quot;C-c J&quot;</span> . #'dumb-jump-go)))</span></code></pre></div>
<p><code>embark</code> is a cool package for discoverability.</p>
<div class="sourceCode" id="cb79" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true"></a>(<span class="kw">use-package</span> embark :bind (<span class="st">&quot;C-c E&quot;</span> . #'embark-act))</span></code></pre></div>
<h2 id="searching">Searching</h2>
<p>deadgrep is the bee’s knees for project-wide search, as it uses <code>ripgrep</code>. I defer to the faster and live-previewing <code>consult-ripgrep</code>, but sometimes deadgrep is more useful.</p>
<div class="sourceCode" id="cb80" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true"></a>(<span class="kw">use-package</span> deadgrep</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true"></a>  :bind ((<span class="st">&quot;C-c H&quot;</span> . #'deadgrep)))</span></code></pre></div>
<p>I remember the days before Emacs had real regular expressions. Nowadays, we have them, but the find-and-replace UI is bad. <code>visual-regexp</code> fixes this. I have this bound to an incredibly stupid keybinding because I simply do not want to take the time to catabolize/forget that particular muscle memory.</p>
<div class="sourceCode" id="cb81" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true"></a>(<span class="kw">use-package</span> visual-regexp</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true"></a>  :bind ((<span class="st">&quot;C-c 5&quot;</span> . #'vr/replace)))</span></code></pre></div>
<h2 id="autocomplete">Autocomplete</h2>
<p>After a long journey with <code>company</code>, I’ve settled on just using the builtin completion-at-point facilities for autocomplete. The UI considerations afforded by Vertico make it even nicer than what Company offered, and consistently faster, too. Someday I want to look into a more aggressive inline autocompletion thing like VSCode supports, but I don’t know</p>
<div class="sourceCode" id="cb82" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true"></a>(bind-key <span class="st">&quot;C-.&quot;</span> #'completion-at-point)</span></code></pre></div>
<h2 id="debugging">Debugging</h2>
<p>In Haskell, my language of choice, I rarely need a step-through debugger, as designs that minimize mutable state make it so printf debugging is usually all you need. (Haskell’s unorthodox evaluation strategy, and its limited step-through debugging facilities, don’t help either.) However, now that I’m writing Rust and Go at work, a step-through debugger is indicated.</p>
<div class="sourceCode" id="cb83" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true"></a>(<span class="kw">use-package</span> dap-mode</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true"></a>  :bind</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true"></a>  (:map dap-mode-map</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true"></a>   (<span class="st">&quot;C-c b b&quot;</span> . dap-breakpoint-toggle)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true"></a>   (<span class="st">&quot;C-c b r&quot;</span> . dap-debug-restart)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true"></a>   (<span class="st">&quot;C-c b l&quot;</span> . dap-debug-last)</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true"></a>   (<span class="st">&quot;C-c b d&quot;</span> . dap-debug))</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true"></a>  :init</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true"></a>  (<span class="kw">require</span> 'dap-go)</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true"></a>  <span class="co">;; NB: dap-go-setup appears to be broken, so you have to download the extension from GH, rename its file extension</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true"></a>  <span class="co">;; unzip it, and copy it into the config so that the following path lines up</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true"></a>  (<span class="kw">setq</span> dap-go-debug-program '(<span class="st">&quot;node&quot;</span> <span class="st">&quot;/Users/patrickt/.config/emacs/.extension/vscode/golang.go/extension/dist/debugAdapter.js&quot;</span>))</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true"></a>  (<span class="kw">defun</span><span class="fu"> pt/turn-on-debugger </span>()</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true"></a>    (interactive)</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true"></a>    (dap-mode)</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true"></a>    (dap-auto-configure-mode)</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true"></a>    (dap-ui-mode)</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true"></a>    (dap-ui-controls-mode)</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true"></a>    )</span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true"></a>  )</span></code></pre></div>
<h2 id="lsp">LSP</h2>
<p>Built-in <code>xref</code> and <code>eldoc</code> are powerful packages, though we pin them to GNU ELPA to pull in the latest versions.</p>
<div class="sourceCode" id="cb84" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true"></a>(<span class="kw">use-package</span> xref</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true"></a>  :pin gnu</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true"></a>  :bind ((<span class="st">&quot;s-r&quot;</span> . #'xref-find-references)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true"></a>         (<span class="st">&quot;s-[&quot;</span> . #'xref-go-back)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true"></a>         (<span class="st">&quot;C-&lt;down-mouse-2&gt;&quot;</span> . #'xref-go-back)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true"></a>         (<span class="st">&quot;s-]&quot;</span> . #'xref-go-forward)))</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true"></a>(<span class="kw">use-package</span> eldoc</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true"></a>  :pin gnu</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true"></a>  :diminish</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true"></a>  :bind (<span class="st">&quot;s-d&quot;</span> . #'eldoc)</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true"></a>  :custom (eldoc-echo-area-prefer-doc-buffer <span class="kw">t</span>))</span></code></pre></div>
<p>Though I used <code>lsp-mode</code> for ages, in my old age I’ve grown happier with packages that try to do less, as they are in almost all cases faster and more reliable. <code>eglot</code> is such a mode.</p>
<div class="sourceCode" id="cb85" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true"></a>(<span class="kw">use-package</span> eglot</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true"></a>  :hook ((go-mode . eglot-ensure)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true"></a>         (haskell-mode . eglot-ensure)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true"></a>         (rust-mode . eglot-ensure))</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true"></a>  :bind (:map eglot-mode-map</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true"></a>              (<span class="st">&quot;C-c a r&quot;</span> . #'eglot-rename)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true"></a>              (<span class="st">&quot;C-&lt;down-mouse-1&gt;&quot;</span> . #'xref-find-definitions)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true"></a>              (<span class="st">&quot;C-S-&lt;down-mouse-1&gt;&quot;</span> . #'xref-find-references)</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true"></a>              (<span class="st">&quot;C-c C-c&quot;</span> . #'eglot-code-actions))</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true"></a>  :custom</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true"></a>  (eglot-autoshutdown <span class="kw">t</span>)</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true"></a>  )</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true"></a></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true"></a>(<span class="kw">use-package</span> consult-eglot</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true"></a>  :bind (:map eglot-mode-map (<span class="st">&quot;s-t&quot;</span> . #'consult-eglot-symbols)))</span></code></pre></div>
<h1 id="haskell">Haskell</h1>
<p>Haskell is my day-to-day programming language, so I’ve tinkered with it a good deal. Featuring automatic <code>ormolu</code> or <code>stylish-haskell</code> invocation, as based on a per-project variable, so I can default to <code>ormolu</code> but choose <code>stylish-haskell</code> for the projects that don’t.</p>
<div class="sourceCode" id="cb86" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true"></a>(<span class="kw">use-package</span> haskell-mode</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true"></a>  :config</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true"></a>  (defcustom haskell-formatter 'ormolu</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true"></a>    <span class="st">&quot;The Haskell formatter to use. One of: 'ormolu, 'stylish, nil. Set it per-project in .dir-locals.&quot;</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true"></a>    :safe 'symbolp)</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true"></a></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true"></a>  (<span class="kw">defun</span><span class="fu"> haskell-smart-format </span>()</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true"></a>    <span class="st">&quot;Format a buffer based on the value of 'haskell-formatter'.&quot;</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true"></a>    (interactive)</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true"></a>    (cl-ecase haskell-formatter</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true"></a>      ('ormolu (ormolu-format-buffer))</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true"></a>      ('stylish (haskell-mode-stylish-buffer))</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true"></a>      (<span class="kw">nil</span> <span class="kw">nil</span>)</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true"></a>      ))</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true"></a></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true"></a></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true"></a>  (<span class="kw">defun</span><span class="fu"> haskell-switch-formatters </span>()</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true"></a>    <span class="st">&quot;Switch from ormolu to stylish-haskell, or vice versa.&quot;</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true"></a>    (interactive)</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true"></a>    (<span class="kw">setq</span> haskell-formatter</span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true"></a>          (cl-ecase haskell-formatter</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true"></a>            ('ormolu 'stylish)</span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true"></a>            ('stylish 'ormolu)</span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true"></a>            (<span class="kw">nil</span> <span class="kw">nil</span>))))</span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true"></a></span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true"></a>  :bind (:map haskell-mode-map</span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true"></a>         (<span class="st">&quot;C-c a c&quot;</span> . haskell-cabal-visit-file)</span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true"></a>         (<span class="st">&quot;C-c a i&quot;</span> . haskell-navigate-imports)</span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true"></a>         (<span class="st">&quot;C-c m&quot;</span>   . haskell-compile)</span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true"></a>         (<span class="st">&quot;C-c a I&quot;</span> . haskell-navigate-imports-return)</span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true"></a>         :map haskell-cabal-mode-map</span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true"></a>         (<span class="st">&quot;C-c m&quot;</span>   . haskell-compile)))</span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true"></a></span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true"></a>(<span class="kw">use-package</span> haskell-snippets</span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true"></a>  :after (haskell-mode yasnippet)</span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true"></a>  :defer)</span></code></pre></div>
<p>My statements about Haskell autoformatters have, in the past, attracted controversy, so I have no further comment on the below lines.</p>
<div class="sourceCode" id="cb87" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true"></a>(<span class="kw">use-package</span> ormolu)</span></code></pre></div>
<h1 id="vterm">vterm</h1>
<p>The state of terminal emulation is, as a whole, a mess. Not just within Emacs, but across all of Unix. (To be fair, terminals are a fascinating study in backwards compatibility and generations upon generations of standards and conventions.) A recent bright spot has been libvterm, which, when integrated with Emacs’s new dynamic module support, enables us to have a very, very fast terminal inside Emacs.</p>
<p>A thing I want to do someday is to write a framework for sending things like compile commands to a running vterm buffer with <code>vterm-send-string</code>. I want a version of the <code>compile</code> command that sends that command to my current <code>vterm</code> buffer. That would be so badass.</p>
<div class="sourceCode" id="cb88" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true"></a>(<span class="kw">use-package</span> vterm</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true"></a>  :config</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true"></a>  (<span class="kw">defun</span><span class="fu"> turn-off-chrome </span>()</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true"></a>    (hl-line-mode <span class="dv">-1</span>)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true"></a>    (display-line-numbers-mode <span class="dv">-1</span>))</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true"></a>  :hook (vterm-mode . turn-off-chrome))</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true"></a></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true"></a>(<span class="kw">use-package</span> vterm-toggle</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true"></a>  :custom</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true"></a>  (vterm-toggle-fullscreen-p <span class="kw">nil</span> <span class="st">&quot;Open a vterm in another window.&quot;</span>)</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true"></a>  (vterm-toggle-scope 'project)</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true"></a>  :bind ((<span class="st">&quot;C-c t&quot;</span> . #'vterm-toggle)</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true"></a>         :map vterm-mode-map</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true"></a>         (<span class="st">&quot;C-</span><span class="sc">\\</span><span class="st">&quot;</span> . #'popper-cycle)</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true"></a>         (<span class="st">&quot;s-t&quot;</span> . #'vterm) <span class="co">; Open up new tabs quickly</span></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true"></a>         (<span class="st">&quot;s-v&quot;</span> . #'vterm-yank)</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true"></a>         ))</span></code></pre></div>
<h1 id="process-management">Process management</h1>
<p><code>prodigy</code> is a great and handsome frontend for managing long-running services. Since many of the services I need to run are closed-source, the calls to <code>prodigy-define-service</code> are located in an adjacent file. Unfortunately, <code>prodigy</code> doesn’t really have any good support for managing Homebrew services. Maybe I’ll write one, in my copious spare time.</p>
<div class="sourceCode" id="cb89" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true"></a>(<span class="kw">use-package</span> prodigy</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true"></a>  :bind ((<span class="st">&quot;C-c 8&quot;</span> . #'prodigy)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true"></a>         :map prodigy-view-mode-map</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true"></a>         (<span class="st">&quot;$&quot;</span> . #'end-of-buffer))</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true"></a>  :custom (prodigy-view-truncate-by-default <span class="kw">t</span>)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true"></a>  :config</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true"></a>  (<span class="kw">load</span> <span class="st">&quot;~/.config/emacs/services.el&quot;</span> 'noerror))</span></code></pre></div>
<h1 id="snippets">Snippets</h1>
<p>I grew up writing in TextMate, so I got extremely used to text-expansion snippets. I also think they’re extremely underrated for learning a new language’s idioms: one of the reasons I was able to get up to speed so fast with Rails (back in the 1.2 days) was because the TextMate snippets indicated pretty much everything you needed to know about things like ActiveRecord.</p>
<div class="sourceCode" id="cb90" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true"></a>(<span class="kw">use-package</span> yasnippet</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true"></a>  :defer <span class="dv">15</span> <span class="co">;; takes a while to load, so do it async</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true"></a>  :diminish yas-minor-mode</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true"></a>  :config (yas-global-mode)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true"></a>  :custom (yas-prompt-functions '(yas-completing-prompt)))</span></code></pre></div>
<h1 id="other-languages">Other Languages</h1>
<h3 id="general-purpose">General-purpose</h3>
<p>Rust is one of my favorite languages in the world.</p>
<div class="sourceCode" id="cb91" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true"></a>(<span class="kw">use-package</span> rust-mode</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true"></a>  :defer <span class="kw">t</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true"></a>  :custom</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true"></a>  (rust-format-on-save <span class="kw">t</span>)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true"></a>  (lsp-rust-server 'rust-analyzer))</span></code></pre></div>
<p>I occasionally write Go, generally as a glue language to munge things together. I find certain aspects of its creators’ philosophies to be repellent, but a language is more than its creators, and it’s hard to argue with the success it’s found in industry or the degree to which people find it easy to pick up.</p>
<div class="sourceCode" id="cb92" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true"></a>(<span class="kw">use-package</span> go-mode</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true"></a>  :defer <span class="kw">t</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true"></a>  :config</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true"></a>  (add-hook 'before-save-hook #'gofmt-before-save))</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true"></a></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true"></a>(<span class="kw">use-package</span> go-snippets :defer <span class="kw">t</span>)</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true"></a>(<span class="kw">defun</span><span class="fu"> fix-messed-up-gofmt-path </span>()</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true"></a>  (interactive)</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true"></a>  (<span class="kw">setq</span> gofmt-command (<span class="kw">string-trim</span> (shell-command-to-string <span class="st">&quot;which gofmt&quot;</span>))))</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true"></a></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true"></a>(<span class="kw">use-package</span> gotest</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true"></a>  :bind (:map go-mode-map</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true"></a>              (<span class="st">&quot;C-c a t&quot;</span> . #'go-test-current-test)))</span></code></pre></div>
<p>Elm is a good language.</p>
<div class="sourceCode" id="cb93" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true"></a>(<span class="kw">use-package</span> elm-mode</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true"></a>  :hook ((elm-mode . elm-format-on-save-mode)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true"></a>         (elm-mode . elm-indent-mode)))</span></code></pre></div>
<p>I don’t write a lot of Python, but when I do I like to use the extremely opinionated <code>black</code> formatter.</p>
<div class="sourceCode" id="cb94" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true"></a>(<span class="kw">use-package</span> blacken</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true"></a>  :hook ((python-mode . blacken-mode)))</span></code></pre></div>
<p>Some other miscellaneous languages that I don’t write often but for which I need syntax highlighting, at least.</p>
<div class="sourceCode" id="cb95" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true"></a>(<span class="kw">use-package</span> typescript-mode :defer <span class="kw">t</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true"></a>(<span class="kw">use-package</span> csharp-mode :defer <span class="kw">t</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true"></a>(setq-default js-indent-level <span class="dv">2</span>)</span></code></pre></div>
<p>I’m trying to learn APL, because I’ve lost control of my life.</p>
<div class="sourceCode" id="cb96" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true"></a>(<span class="kw">use-package</span> dyalog-mode :defer <span class="kw">t</span>)</span></code></pre></div>
<h3 id="configuration">Configuration</h3>
<div class="sourceCode" id="cb97" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true"></a>(<span class="kw">use-package</span> yaml-mode :defer <span class="kw">t</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true"></a>(<span class="kw">use-package</span> dockerfile-mode :defer <span class="kw">t</span>)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true"></a>(<span class="kw">use-package</span> toml-mode :defer <span class="kw">t</span>)</span></code></pre></div>
<p>I use Bazel for some Haskell projects.</p>
<div class="sourceCode" id="cb98" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true"></a>(<span class="kw">use-package</span> bazel</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true"></a>  :defer <span class="kw">t</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true"></a>  :config</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true"></a>  (add-hook 'bazel-mode-hook (<span class="kw">lambda</span> () (add-hook 'before-save-hook #'bazel-mode-buildifier <span class="kw">nil</span> <span class="kw">t</span>)))</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true"></a>  )</span></code></pre></div>
<h3 id="interchange">Interchange</h3>
<div class="sourceCode" id="cb99" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true"></a>(<span class="kw">use-package</span> protobuf-mode :defer <span class="kw">t</span>)</span></code></pre></div>
<h3 id="markup">Markup</h3>
<p>I generally use GitHub-flavored Markdown, so we default to that.</p>
<div class="sourceCode" id="cb100" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true"></a>(<span class="kw">use-package</span> markdown-mode</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true"></a>  :bind (:map markdown-mode-map (<span class="st">&quot;C-c C-s a&quot;</span> . markdown-table-align))</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true"></a>  :mode (<span class="st">&quot;</span><span class="sc">\\</span><span class="st">.md$&quot;</span> . gfm-mode))</span></code></pre></div>
<p>Occasionally I need to edit Rails .erb templates, God help me.</p>
<div class="sourceCode" id="cb101" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true"></a>(<span class="kw">use-package</span> web-mode</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true"></a>  :custom (web-mode-markup-indent-offset <span class="dv">2</span>)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true"></a>  :mode (<span class="st">&quot;</span><span class="sc">\\</span><span class="st">.html.erb$&quot;</span> . web-mode))</span></code></pre></div>
<p>I usually use curly quotes when writing in markup languages, which <code>typo-mode</code> makes easy.</p>
<div class="sourceCode" id="cb102" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true"></a>(<span class="kw">use-package</span> typo :defer <span class="kw">t</span>)</span></code></pre></div>
<h3 id="shell">Shell</h3>
<p><code>fish</code> is the only shell that doesn’t make me want to defenestrate. The only time I use anything else is when I have to use TRAMP to connect to a codespace, in which case I need to use zsh, as <code>fish</code> is not POSIX-compliant.</p>
<div class="sourceCode" id="cb103" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true"></a>(<span class="kw">use-package</span> fish-mode :defer <span class="kw">t</span>)</span></code></pre></div>
<h1 id="miscellany">Miscellany</h1>
<p><code>restclient</code> is a terrific interface for running HTTP requests against local or remote services.</p>
<div class="sourceCode" id="cb104" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true"></a>(<span class="kw">use-package</span> restclient</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true"></a>  :mode (<span class="st">&quot;</span><span class="sc">\\</span><span class="st">.restclient$&quot;</span> . restclient-mode))</span></code></pre></div>
<p><code>Dash</code> is the foremost documentation browser for macOS.</p>
<div class="sourceCode" id="cb105" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true"></a>(<span class="kw">use-package</span> dash-at-point</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true"></a>  :bind (<span class="st">&quot;C-c d&quot;</span> . dash-at-point))</span></code></pre></div>
<p>TRAMP mode is excellent for editing files on a remote machine or Docker container, but it needs some TLC.</p>
<div class="sourceCode" id="cb106" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true"></a>(<span class="kw">require</span> 'tramp)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true"></a>(<span class="kw">setq</span> tramp-default-method <span class="st">&quot;ssh&quot;</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true"></a>      tramp-verbose <span class="dv">1</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true"></a>      tramp-default-remote-shell <span class="st">&quot;/bin/bash&quot;</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true"></a>      tramp-connection-local-default-shell-variables</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true"></a>        '((shell-file-name . <span class="st">&quot;/bin/bash&quot;</span>)</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true"></a>          (shell-command-switch . <span class="st">&quot;-c&quot;</span>)))</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true"></a></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true"></a>(connection-local-set-profile-variables 'tramp-connection-local-default-shell-profile</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true"></a>  '((shell-file-name . <span class="st">&quot;/bin/bash&quot;</span>)</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true"></a>   (shell-command-switch . <span class="st">&quot;-c&quot;</span>)))</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true"></a></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true"></a>(lsp-register-client</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true"></a> (make-lsp-client :new-connection (lsp-stdio-connection <span class="st">&quot;gopls&quot;</span>)</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true"></a>                  :major-modes '(go-mode go-dot-mod-mode)</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true"></a>                  :language-id <span class="st">&quot;go&quot;</span></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true"></a>                  :remote? <span class="kw">t</span></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true"></a>                  :priority <span class="dv">0</span></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true"></a>                  :server-id 'gopls-remote</span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true"></a>                  :completion-in-comments? <span class="kw">t</span></span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true"></a>                  :library-folders-fn #'lsp-go--library-default-directories</span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true"></a>                  :after-open-fn (<span class="kw">lambda</span> ()</span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true"></a>                                   <span class="co">;; https://github.com/golang/tools/commit/b2d8b0336</span></span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true"></a>                                   (setq-local lsp-completion-filter-on-incomplete <span class="kw">nil</span>))))</span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true"></a></span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true"></a><span class="co">;; add gh codespaces ssh method support for tramp editing</span></span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true"></a><span class="co">;; e.g. C-x C-f /ghcs:codespace-name:/path/to/file</span></span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true"></a><span class="co">;; thanks to my coworker Bas for this one</span></span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true"></a>(<span class="kw">let</span> ((ghcs (<span class="kw">assoc</span> <span class="st">&quot;ghcs&quot;</span> tramp-methods))</span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true"></a>      (ghcs-methods '((tramp-login-program <span class="st">&quot;gh&quot;</span>)</span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true"></a>                      (tramp-login-args ((<span class="st">&quot;codespace&quot;</span>) (<span class="st">&quot;ssh&quot;</span>) (<span class="st">&quot;-c&quot;</span>) (<span class="st">&quot;%h&quot;</span>)))</span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true"></a>                      (tramp-remote-shell <span class="st">&quot;/bin/sh&quot;</span>)</span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true"></a>                      (tramp-remote-shell-login (<span class="st">&quot;-l&quot;</span>))</span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true"></a>                      (tramp-remote-shell-args (<span class="st">&quot;-c&quot;</span>)))))</span>
<span id="cb106-35"><a href="#cb106-35" aria-hidden="true"></a>  <span class="co">;; just for debugging the methods</span></span>
<span id="cb106-36"><a href="#cb106-36" aria-hidden="true"></a>  (<span class="kw">if</span> ghcs (setcdr ghcs ghcs-methods)</span>
<span id="cb106-37"><a href="#cb106-37" aria-hidden="true"></a>    (<span class="kw">push</span> (<span class="kw">cons</span> <span class="st">&quot;ghcs&quot;</span> ghcs-methods) tramp-methods)))</span></code></pre></div>
<p>I use <code>direnv</code> to manage per-project environment variables. The Emacs direnv mode is quite sophisticated, automatically setting all relevant variables for you when you go in and out of a particular project.</p>
<div class="sourceCode" id="cb107" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true"></a>(<span class="kw">use-package</span> direnv</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true"></a>  :config (direnv-mode)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true"></a>  :custom (direnv-always-show-summary <span class="kw">nil</span>))</span></code></pre></div>
<h1 id="initial-screen-setup">Initial screen setup</h1>
<div class="sourceCode" id="cb108" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true"></a>(<span class="kw">defun</span><span class="fu"> my-default-window-setup </span>()</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true"></a>  <span class="st">&quot;Called by emacs-startup-hook to set up my initial window configuration.&quot;</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true"></a></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true"></a>  (split-window-right)</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true"></a>  (other-window <span class="dv">1</span>)</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true"></a>  (find-file <span class="st">&quot;~/txt/todo.org&quot;</span>)</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true"></a>  (other-window <span class="dv">1</span>))</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true"></a></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true"></a>(add-hook 'emacs-startup-hook #'my-default-window-setup)</span></code></pre></div>
<h1 id="adios">Adios</h1>
<p>If you made it this far, well, may your deity of choice bless you. If you don’t use Emacs already, I hope I tempted you a little. If you do, I hope you learned a couple new tricks, just as I have learned so many tricks from reading dozens of other people’s configs.</p>
<p>Au revoir.</p>
<div class="sourceCode" id="cb109" data-org-language="emacs-lisp"><pre class="sourceCode commonlisp"><code class="sourceCode commonlisp"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true"></a>(<span class="kw">provide</span> 'init)</span></code></pre></div>
                </section>
            </article>
        </div>
    </body>

</html>
